{% extends "base.html" %}
{% load i18n %}

{% block content %}
{% if messages %}
{% for message in messages %}
<div class="alert alert-dismissible alert-{{message.tags}}">
<button type="button" class="close" data-dismiss="alert">&times;</button>
  {{ message }}
</div>
{% endfor %}
{% endif %}

<div class="bs-docs-section">
  <div class="row">
    <div class="col-lg-4">
      <div class="well bs-component">
        <form class="form-horizontal" method="POST" action="{% url 'make_backup' %}">
          {% csrf_token %}
          <fieldset>
            <legend>{{ _('data_backup') }}</legend>

            <div class="form-group" id="select_groups">
              {% include "_select_groups.html" %}
            </div>
            <div class="form-group" id="select_servers">
              {% include "_select_servers.html" %}
            </div>
            <div class="form-group" id="select_databases">
              {% include "_select_databases.html" %}
            </div>

            <div class="panel-body">
              <strong> {{ _('options') }} </strong>
            </div>
            
            <div class="form-group">
              <div class="col-lg-12">
                <div class="well">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" name='opt_inserts'> &nbsp;  {{ _('inserts') }}
                    </label>
                  </div>
                  <div class="checkbox">
                    <label>
                      <input type="checkbox"  name='opt_clean'> &nbsp; {{ _('clean') }}
                    </label>
                  </div>
                  <br>
                    <label for="db_select" class="control-label">{{ _('extra_options') }}</label>
                    <input class="form-control" name="extra_options" id="extra_options" type="text">
                </div>
              </div>
            </div>

            <div class="form-group">
              <div class="col-lg-10 col-lg-offset-7">
                <button type="submit" id="make_backup" class="btn btn-primary">{{ _('make_backup') }}</button>
              </div>
            </div>
            
          </fieldset>
        </form>
        <div style="display: none;" id="source-button"
             class="btn btn-primary btn-xs">&lt; &gt;
        </div>
      </div>
    </div>



    <div class="col-lg-8">

      <form class="bs-component">
        <div class="bs-component" id="backups_lists">
          {% include "_backups_lists.html" %}
          <br>
          {% if user_notification %}
            <div class="well" id="user_notification">
              {{ user_notification | safe }}
            </div>
          {% endif %}
        </div>
      </form>
      
    </div>
  </div>


</div>
<script>

$(document).ready(function(){

  $("#make_backup").click(function() {
    if ( !confirm("{{ _('confirm_make_backup') }}") ) {
      return false;
    }
  });

  $('#group_select').change(function () {
    $.ajax({
        url: "{% url 'update_servers' %}",
        data: {
            group_id: $('#group_select').val()
        },
        type: "GET",
        dataType: "html",
        success: function (data) {
            $('#select_servers').html(data);
        },
    }).done(function (data) {
        $('#server_select').change();
    })
    $.ajax({
        url: "{% url 'update_list_backups' %}",
        data: {
            group_id: $('#group_select').val()
        },
        type: "GET",
        dataType: "html",
        success: function (data) {
            $('#backups_lists').html(data);
        },
    })
  });


   
});
</script>    
{% endblock %}
